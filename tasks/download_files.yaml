---
# tasks file for download ocp files
  - name: Delete OCP4 files, if requested, to download again
    file:
         state: absent
         path: "{{ item }}"
    with_items:
        - "/usr/local/src/openshift-client-linux.tar.gz"
        - "/usr/local/src/openshift-install-linux.tar.gz"
        - "/usr/local/src/rhcos-live-{{ rhcos_arch }}.iso"
    when: force_ocp_download

  - name: Downloading OCP4 rhcos-live.iso
    when: rhcos_iso is defined
    get_url:
        url: "{{ rhcos_iso }}"
        dest: "/usr/local/src/rhcos-live-{{ rhcos_arch }}.iso"
        mode: 0555

  - name: Preparing OCP client
    when: ocp_client is defined
    block:
    - name: Downloading OCP4 client
      get_url:
        url: "{{ ocp_client }}"
        dest: /usr/local/src/openshift-client-linux.tar.gz

    - name: Unarchiving OCP4 client
      unarchive:
        src: /usr/local/src/openshift-client-linux.tar.gz
        dest: /usr/local/bin
        remote_src: yes

  - name: Preparing OCP installer
    when: ocp_installer is defined
    block:
    - name: Downloading OCP4 Installer
      get_url:
        url: "{{ ocp_installer }}"
        dest: /usr/local/src/openshift-install-linux.tar.gz

    - name: Unarchiving OCP4 Installer
      unarchive:
        src: /usr/local/src/openshift-install-linux.tar.gz
        dest: /usr/local/bin
        remote_src: yes

  - name: Removing files that are not needed
    file:
      path: /usr/local/bin/README.md
      state: absent